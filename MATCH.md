# 주문내역 영수증 매치 개선 방안

## 프로젝트의 목표

기존에 사람이 하고 있던 주문 내역과 주문 내역에 대한 영수증의 비교하여 주문한 상품이 정상 처리되었는지 미송건인지 혹은 영수증에 데이터가 없는지를 엑셀에 남기고 있었는데 이 과정을 자동화 하고자 함

## 데이터

### 주문 내역 데이터

| 브랜드 | 상품명        | 색상    | 사이즈 | 수량 | 상가명 | 도매가  | Nor상품명         | Nor색상   | Nor사이즈 |
|--------|---------------|---------|-------|------|--------|--------|-------------------|-----------|-----------|
| nrk    | ST시보리티    | 베이지  | M     | 1    | 크레용  | 9000   | S티셔츠시보리티셔츠 | 베이지     | M         |
| nrk    | 골덴팔부바지   | 베이지  | S     | 1    | 크레용  | 15000  | 골덴팔부팬츠       | 베이지     | S         |
| nrk    | 골덴팔부바지   | 차콜    | XL    | 1    | 크레용  | 15000  | 골덴팔부팬츠       | 챠콜      | XL        |
| nrk    | 그라운드남방  | 아이    | XL    | 1    | 크레용  | 18000  | 그라운드남방       | 아이보리   | XL        |
| nrk    | 덴깡카라맨투맨 | 검정    | 4XL   | 1    | 크레용  | 21000  | 덴깡카라맨투맨     | 블랙      | 4XL       |
| nrk    | 덴깡카라맨투맨 | 핑크    | M     | 1    | 크레용  | 18000  | 덴깡카라맨투맨     | 핑크      | M         |
| nrk    | 덴깡카라맨투맨 | 핑크    | S     | 1    | 크레용  | 18000  | 덴깡카라맨투맨     | 핑크      | S         |
| nrk    | 면카라니트    | 블랙    | L     | 1    | 크레용  | 22000  | 면카라니트         | 블랙      | L         |
| nrk    | 면카라니트    | 블랙    | L     | 1    | 크레용  | 22000  | 면카라니트         | 블랙      | L         |
| nrk    | 버디단가라세트 | 레드    | L     | 1    | 크레용  | 23000  | 버디단가라세트     | 레드      | L         |
| nrk    | 버디단가라세트 | 파랑    | L     | 1    | 크레용  | 23000  | 버디단가라세트     | 블루      | L         |
| nrk    | 보데티        | 네이비  | S     | 1    | 크레용  | 10000  | 보데티셔츠         | 네이비     | S         |
| nrk    | 보데티        | 아이    | S     | 1    | 크레용  | 10000  | 보데티셔츠         | 아이보리   | S         |
| nrk    | 스쿨룩조끼    | 아이    | XS    | 1    | 크레용  | 18000  | 스쿨룩조끼         | 아이보리   | XS        |
| nrk    | 스쿨룩조끼    | 아이(크림) | 4XL | 1    | 크레용  | 21000  | 스쿨룩조끼         | 아이크림   | 4XL       |
| nrk    | 어텀테이프세트 | 메란지  | M     | 1    | 크레용  | 25000  | 어텀테이프세트     | 메란지지   | M         |
| nrk    | 어텀테이프세트 | 메란지  | XL    | 1    | 크레용  | 25000  | 어텀테이프세트     | 메란지지   | XL        |
| nrk    | 와플테입티    | 곤색    | S     | 1    | 크레용  | 16000  | 와플테입티셔츠     | 곤색      | S         |
| nrk    | 주름팔부바지   | 메란지  | M     | 1    | 크레용  | 17000  | 주름팔부팬츠       | 메란지지   | M         |
| nrk    | 주름팔부바지   | 메란지  | S     | 1    | 크레용  | 17000  | 주름팔부팬츠       | 메란지지   | S         |
| nrk    | 트렌디시보리티 | 와인    | M     | 1    | 크레용  | 12000  | 트렌디시보리티셔츠 | 와인      | M         |
| nrk    | 파리카라세트   | 백메란지 | 4XL  | 1    | 크레용  | 26000  | 파리카라세트       | 백메란지지 | 4XL       |
| nrk    | 팔팔상하세트   | 네이비  | XL    | 1    | 크레용  | 22000  | 팔팔상하세트       | 네이비     | XL        |
| nrk    | 팔팔상하세트   | 크림    | 2XL   | 1    | 크레용  | 25000  | 팔팔상하세트       | 크림      | 2XL       |
| nrk    | 팔팔상하세트   | 크림    | L     | 1    | 크레용  | 22000  | 팔팔상하세트       | 크림      | L         |
| nrk    | 팔팔상하세트   | 크림    | S     | 1    | 크레용  | 22000  | 팔팔상하세트       | 크림      | S         |
| nrk    | 피셔맨니트     | 네이비  | L     | 1    | 크레용  | 25000  | 피셔맨니트         | 네이비     | L         |

### 영수증 데이터

| 브랜드 | 상품명        | 색상    | 사이즈 | 수량 | 미송여부 | Nor상품명         | Nor색상   | Nor사이즈 |
|--------|---------------|---------|-------|------|---------|-------------------|-----------|-----------|
| nrk    | 23.ST시보리티 | 베이지  | M     | 1    | FALSE   | S티셔츠시보리티셔츠 | 베이지     | M         |
| nrk    | 33.골덴팔부바지 | 베이지  | S     | 1    | TRUE    | 골덴팔부팬츠       | 베이지     | S         |
| nrk    | 33.골덴팔부바지 | 차콜    | XL    | 1    | FALSE   | 골덴팔부팬츠       | 챠콜      | XL        |
| nrk    | 5.그라운드남방  | 아이보리 | XL    | 1    | FALSE   | 그라운드남방       | 아이보리   | XL        |
| nrk    | 20.덴깡카라맨투맨 | 검정    | 4XL   | 1    | FALSE   | 덴깡카라맨투맨     | 블랙      | 4XL       |
| nrk    | 20.덴장카라맨투맨 | 핑크    | S     | 1    | TRUE    | 덴장카라맨투맨     | 핑크      | S         |
| nrk    | 20.덴깡카라맨투맨 | 핑크    | M     | 1    | TRUE    | 덴깡카라맨투맨     | 핑크      | M         |
| nrk    | 8.면카라니트    | 검정    | L     | 2    | FALSE   | 면카라니트         | 블랙      | L         |
| nrk    | 15.버디단가라세트 | 레드    | L     | 1    | FALSE   | 버디단가라세트     | 레드      | L         |
| nrk    | 15.버디단가라세트 | 파랑    | L     | 1    | TRUE    | 버디단가라세트     | 블루      | L         |
| nrk    | 25.보데티      | 네이비  | S     | 1    | FALSE   | 보데티셔츠         | 네이비     | S         |
| nrk    | 25.보데티      | 아이    | S     | 1    | FALSE   | 보데티셔츠         | 아이보리   | S         |
| nrk    | 9.스쿨룩조끼    | 아이    | XS    | 1    | FALSE   | 스쿨룩조끼         | 아이보리   | XS        |
| nrk    | 9.스쿨룩조끼    | 아이    | 4XL   | 1    | FALSE   | 스쿨룩조끼         | 아이보리   | 4XL       |
| nrk    | 14.어텀테이프세트 | 메란지  | M     | 1    | TRUE    | 어텀테이프세트     | 메란지지   | M         |
| nrk    | 14.어텀테이프세트 | 메란지  | XL    | 1    | TRUE    | 어텀테이프세트     | 메란지지   | XL        |
| nrk    | 21.와플테입티   | 곤색    | S     | 1    | FALSE   | 와플테입티셔츠     | 곤색      | S         |
| nrk    | 32.주름팔부바지  | 메란지  | S     | 1    | FALSE   | 주름팔부팬츠       | 메란지지   | S         |
| nrk    | 32.주름팔부바지  | 메란지  | M     | 1    | FALSE   | 주름팔부팬츠       | 메란지지   | M         |
| nrk    | 26.트렌디시보리티 | 와인    | M     | 1    | FALSE   | 트렌디시보리티셔츠 | 와인      | M         |
| nrk    | 16.파리카라세트  | 백메란지 | 4XL  | 1    | FALSE   | 파리카라세트       | 백메란지지 | 4XL       |
| nrk    | 12.팔팔상하세트  | 네이비  | XL    | 1    | TRUE    | 팔팔상하세트       | 네이비     | XL        |
| nrk    | 12.팔팔상하세트  | 크림    | 2XL   | 1    | FALSE   | 팔팔상하세트       | 크림      | 2XL       |
| nrk    | 12.팔팔상하세트  | 크림    | L     | 1    | FALSE   | 팔팔상하세트       | 크림      | L         |
| nrk    | 12.팔팔상하세트  | 크림    | S     | 1    | TRUE    | 팔팔상하세트       | 크림      | S         |
| nrk    | 7.피셔맨니트    | 네이비  | L     | 1    | FALSE   | 피셔맨니트         | 네이비     | L         |

## 문제 해결 방법

주문 내역은 엑셀로 정리되어 있고 영수증은 이미지로 전달받게 됨.

1. 영수증 이미지를 OCR하여 텍스트 데이터로 전환
2. GPT API를 이용하여 텍스트 영수증 데이터를 CSV 형식의 데이터로 전환 및 CSV 포맷 검증
3. 원본 주문 내역과 영수증 데이터의 상품명, 색상, 사이즈를 normalize 하여 오타 수정, 용어 통일, 약자 수정, 특수문자나 상품 번호등의 표기 제거 작업을 진행
4. normalize된 상품명, 색상, 사이즈를 비교하여 일치하는 상품을 찾고 정상 처리된 건인지 미송 건인지 표기

## 봉착한 문제

4번 단계에서 상품명, 색상, 사이즈가 모두 일치하는 상품만 처리했더니 매칭율이 약 50%정도인 상태

### 문제 해결을 위한 접근

사람이 영수증 데이터를 처리할때처럼 접근하고자 함

- 사람은 모든 필드를 매번 보지 않음
  - 상품 정보가 고유하다면 모든 필드가 일치하지 않더라도 상품을 구분할 수 있음
  - 예를 들어 상품명이 1건만 존재하는 경우, 상품명은 여러개지만 색상이 모두 달라 사이즈나 기타 필드를 검증하지 않고도 매칭 처리할 수 있는 경우
- 이를 이용하여 일부만 일치하더라도 유니크함이 보장되면 매칭 처리

## 알고리즘
- 주문 내역을 브랜드별로 그룹핑
- 그루핑된 주문 내역을 주문 내역 내에서 유니크 레벨을 부여(같은 이름의 상품이 없다면 레벨0, 같은 이름의 상품이 있는 경우 레벨1, 상품명, 색상이 같은게 있으면 레벨2, )
